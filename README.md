<div align="center">

<picture>
  <source media="(prefers-color-scheme: light)" srcset="/public/wavereplay.svg">
  <img alt="wavereplay logo" src="/public/wavereplay_white.svg" width="50%" height="50%">
</picture>

wavereplay: surf video analysis

[![Build](https://github.com/jack-laverty/wavereplay/actions/workflows/test.yml/badge.svg)](https://github.com/jack-laverty/wavereplay/actions/workflows/test.yml)

<h3>

[Overview](#overview) | [Tech Stack](#tech-stack)

</h3>

</div>

---



## Overview

Learning to build a fullstack Next.js/React web app and maybe learning to surf good too.

It's a simple dashboard to view all your sessions and a standard video player with some additional playback controls, timestamped annotations, and a glassboard overlay.



## Tech Stack

### [NextJS](https://nextjs.org/docs)

The whole show runs on the NextJS framework. It runs a later version so it uses the [App Router](https://nextjs.org/docs/app) to navigate between pages. [Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers) are used to access backend resources.
Authentication is implemented with [Supabase Auth](https://supabase.com/docs/guides/auth). React server components are used where possible. The majority of components are styled with tailwind CSS.

### [Supabase](https://supabase.com/)

#### [Supabase Database](https://supabase.com/docs/guides/database/overview)
Sessions are stored in a sessions table. The session table primary key is a unique ID which is generated by Supabase.

Clips are stored in a clips table that use a foreign key to link groups of clips to a particular session via the session ID.

Row Level Security (RLS) is enabled for both. During development each database has policies that only give access to my user ID.

#### [Supabase Storage](https://supabase.com/docs/guides/storageo)

A Supabase Storage Server is used for video file storage. It's S3 API compatible.

Video files are uploaded using [signed upload urls](https://supabase.com/docs/reference/javascript/storage-from-createsigneduploadurl) to allow clients to upload directly to the S3 storage server.

#### [Supabase Auth](https://authjs.dev/getting-started/authentication/oauth)

Supabase Auth is used for authentication. GitHub provides a free OAuth service as the app is registered in the GitHub developer dashboard. Supabase provides [configuration docs](https://supabase.com/docs/guides/auth/social-login/auth-github) for this use case. Unauthenticated users are redirected to the login page via middleware.

Note there is some config external to the application that is required for this system

In GitHub OAuth app settings, ensure the `Authorization callback URL` is set to https:your-project.supabase.co/auth/v1/callback.

In Supabase, under Authentication > URL Configuration:
* Site URL should be the web apps base URL (e.g., http://localhost:3000 for local development)
* Redirect URLs should include http://localhost:3000/auth/callback for local development and your production callback URL.

[Servers-Side Auth for Next.js](https://supabase.com/docs/guides/auth/server-side/nextjs)



## Design

### File Uploads

* max file size is 50MB
* max number of files per session is 20
* max number of sessions per user is 20
* access is given on a per user basis so the number of users is controlled
* presigned upload URLs give client direct upload capability and are valid for 2 hours from creation
